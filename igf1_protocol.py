import json
import os
from typing import Dict, List
import logging

logger = logging.getLogger(__name__)

class IGF1ProtocolHandler:
    def __init__(self):
        self.data_dir = "data/igf1"
        self.protocol = {
            "meta": {
                "title": "–ü—Ä–æ—Ç–æ–∫–æ–ª IGF-1 —Ç–∞ HGH –¥–ª—è PantelMed",
                "description": "–ü—Ä–µ–≤–µ–Ω—Ç–∏–≤–Ω–∏–π –±—ñ–æ—Ö–∞–∫—ñ–Ω–≥ –¥–ª—è —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–∞ –∞–Ω—Ç–∏–µ–π–¥–∂–∏–Ω–≥—É –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ä–∏–∑–∏–∫—ñ–≤."
            },
            "mechanisms": {
                "hgh_igf1": {
                    "name": "HGH —Ç–∞ IGF-1",
                    "description": "HGH —Å—Ç–∏–º—É–ª—é—î —Å–∏–Ω—Ç–µ–∑ IGF-1 –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∫–∞–Ω–∏–Ω. –†—ñ–≤–Ω—ñ –ø–∞–¥–∞—é—Ç—å –Ω–∞ 14% —â–æ—Ä–æ–∫—É –ø—ñ—Å–ª—è 30-40 —Ä–æ–∫—ñ–≤, –≤–∏–∫–ª–∏–∫–∞—é—á–∏ —Å–æ–º–∞—Ç–æ–ø–∞—É–∑—É.",
                    "benefits": {
                        "skin": "+20-30% —Å–∏–Ω—Ç–µ–∑ –∫–æ–ª–∞–≥–µ–Ω—É/–µ–ª–∞—Å—Ç–∏–Ω—É, –∑–≤–æ–ª–æ–∂–µ–Ω–Ω—è, –∑–º–µ–Ω—à–µ–Ω–Ω—è –∑–º–æ—Ä—à–æ–∫.",
                        "hair": "+15-25% –≥—É—Å—Ç–æ—Ç–∞, –ø–æ–¥–æ–≤–∂–µ–Ω–Ω—è —Ñ–∞–∑–∏ —Ä–æ—Å—Ç—É.",
                        "nails": "–ü–æ—Å–∏–ª–µ–Ω–Ω—è –∫–µ—Ä–∞—Ç–∏–Ω—É, –∑–º–µ–Ω—à–µ–Ω–Ω—è –ª–∞–º–∫–æ—Å—Ç—ñ.",
                        "muscles": "+30-50% —Å–∏–Ω—Ç–µ–∑ –±—ñ–ª–∫–∞, –ø—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏–∫–∞ —Å–∞—Ä–∫–æ–ø–µ–Ω—ñ—ó.",
                        "joints": "+25-40% –º–æ–±—ñ–ª—å–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ —Å–∏–Ω–æ–≤—ñ–∞–ª—å–Ω—É —Ä—ñ–¥–∏–Ω—É.",
                        "hydration": "–ü—Ä–æ—Ç–∏–¥—ñ—è –≤–∏—Å–∏—Ö–∞–Ω–Ω—é –∫–ª—ñ—Ç–∏–Ω."
                    },
                    "paradox": "–í–∏—Å–æ–∫–∏–π IGF-1 (>300 –Ω–≥/–º–ª) –ø—Ä–∏—Å–∫–æ—Ä—é—î —Å—Ç–∞—Ä—ñ–Ω–Ω—è —á–µ—Ä–µ–∑ –º–µ—Ç–∞–±–æ–ª—ñ—á–Ω–∏–π –ø–µ—Ä–µ–≥—Ä—ñ–≤. –ë–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ —Ü–∏–∫–ª–∏."
                }
            },
            "risks": {
                "oncology": "–†–∏–∑–∏–∫ –ø—Ä–∏ IGF-1 >300 –Ω–≥/–º–ª (—Ä–∞–∫ –ø—Ä–æ—Å—Ç–∞—Ç–∏, –º–æ–ª–æ—á–Ω–æ—ó –∑–∞–ª–æ–∑–∏).",
                "diabetes": "+10-20% –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –≥–ª—é–∫–æ–∑–∏, –∞–Ω—Ç–∞–≥–æ–Ω—ñ–∑–º –∑ —ñ–Ω—Å—É–ª—ñ–Ω–æ–º.",
                "other": "–ù–∞–±—Ä—è–∫–∏, –±—ñ–ª—å —É —Å—É–≥–ª–æ–±–∞—Ö, –∫–∞—Ä–ø–∞–ª—å–Ω–∏–π —Ç—É–Ω–µ–ª—å."
            },
            "risk_mitigation": {
                "oncology": ["–¢—Ä–∞–º–µ—Ç–µ—Å 1-3 –≥/–¥–µ–Ω—å", "–ö—É—Ä–∫—É–º—ñ–Ω 500-1000 –º–≥", "–†–µ—Å–≤–µ—Ä–∞—Ç—Ä–æ–ª 200-500 –º–≥", "EGCG 300-600 –º–≥", "–ù–∏–∑—å–∫–µ –∑–∞–ø–∞–ª–µ–Ω–Ω—è (–∫–µ—Ç–æ/—Å–µ—Ä–µ–¥–∑–µ–º–Ω–æ–º–æ—Ä—Å—å–∫–∞)"],
                "diabetes": ["–ë–µ—Ä–±–µ—Ä–∏–Ω 500-1000 –º–≥", "–ö–æ—Ä–∏—Ü—è 1-2 –≥", "–•—Ä–æ–º –ø—ñ–∫–æ–ª—ñ–Ω–∞—Ç 200-400 –º–∫–≥", "–ú–µ—Ç—Ñ–æ—Ä–º—ñ–Ω 500-1000 –º–≥ (—Ä–µ—Ü–µ–ø—Ç)"],
                "general": ["150 —Ö–≤/—Ç–∏–∂–¥–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ", "BMI <25", "CRP <1 –º–≥/–ª"]
            },
            "assessment": {
                "initial_tests": ["IGF-1 (80-250 –Ω–≥/–º–ª)", "HGH", "–Ü–Ω—Å—É–ª—ñ–Ω", "HbA1c", "C-–ø–µ–ø—Ç–∏–¥", "–ö–æ—Ä—Ç–∏–∑–æ–ª", "–¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω", "CRP", "–û–Ω–∫–æ–º–∞—Ä–∫–µ—Ä–∏"],
                "dosage_factors": {
                    "bmi": {"<20": "–ù–∏–∑—å–∫—ñ –¥–æ–∑–∏", "20-25": "–°—Ç–∞–Ω–¥–∞—Ä—Ç", ">25": "–í–∏—â—ñ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ"},
                    "activity": {"<5k": "–ù–∏–∑—å–∫–∞", "5-10k": "–°–µ—Ä–µ–¥–Ω—è", ">10k + 3-5 —Ç—Ä–µ–Ω—É–≤–∞–Ω—å": "–í–∏—Å–æ–∫–∞"},
                    "diet": {"–í–∏—Å–æ–∫–æ–≤—É–≥–ª–µ–≤–æ–¥–Ω–∞": "–ù–∏–∂—á—ñ –¥–æ–∑–∏", "–ë–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∞": "–°–µ—Ä–µ–¥–Ω—è", "–ö–µ—Ç–æ/–∫–∞—Ä–Ω—ñ–≤–æ—Ä": "–í–∏—â–∞ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω—ñ—Å—Ç—å"}
                },
                "monitoring": "–ö–æ–∂–Ω—ñ 3-4 –º—ñ—Å—è—Ü—ñ, –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –¥–æ–∑ –Ω–∞ 20% –∑–∞ IGF-1."
            },
            "natural_boost": {
                "diet": [
                    "–ö–µ—Ç–æ/–ö–∞—Ä–Ω—ñ–≤–æ—Ä: 40-50% –∂–∏—Ä—ñ–≤, 30% –±—ñ–ª–∫—ñ–≤ (1.6-2 –≥/–∫–≥), <50-100 –≥ –≤—É–≥–ª–µ–≤–æ–¥—ñ–≤.",
                    "–°–µ—Ä–µ–¥–∑–µ–º–Ω–æ–º–æ—Ä—Å—å–∫–∞: –û–≤–æ—á—ñ, —Ä–∏–±–∞, –≥–æ—Ä—ñ—Ö–∏.",
                    "–ì–æ–ª–æ–¥—É–≤–∞–Ω–Ω—è 16/8, 2-3 –¥–Ω—ñ/—Ç–∏–∂–¥–µ–Ω—å (+300% HGH)."
                ],
                "training": ["HIIT 20 —Ö–≤, 2-3 —Ä–∞–∑–∏/—Ç–∏–∂–¥–µ–Ω—å (+400-700% HGH)", "–°–∏–ª–æ–≤—ñ 3 —Ä–∞–∑–∏/—Ç–∏–∂–¥–µ–Ω—å", "–ô–æ–≥–∞ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ—Å—Ç—ñ"],
                "supplements": [
                    "L-–∞—Ä–≥—ñ–Ω—ñ–Ω 3-5 –≥ (–±—É—Å—Ç HGH)",
                    "–ì–ª—é—Ç–∞–º—ñ–Ω 2-5 –≥ (+78% HGH)",
                    "GABA 500-1000 –º–≥ (—Å–æ–Ω)",
                    "–ö–æ–ª–∞–≥–µ–Ω II 10 –≥/–¥–µ–Ω—å",
                    "–ì—ñ–∞–ª—É—Ä–æ–Ω–æ–≤–∞ –∫–∏—Å–ª–æ—Ç–∞ 100-200 –º–≥",
                    "–í—ñ—Ç–∞–º—ñ–Ω D3 2000-4000 –ú–û + –û–º–µ–≥–∞-3 2 –≥"
                ],
                "practices": ["7-8 –≥–æ–¥ —Å–Ω—É", "–ú–µ–¥–∏—Ç–∞—Ü—ñ—è 10 —Ö–≤/–¥–µ–Ω—å"]
            },
            "therapeutic_protocols": {
                "cycle": "8-12 —Ç–∏–∂–Ω—ñ–≤, 5-6 –¥–Ω—ñ–≤/—Ç–∏–∂–¥–µ–Ω—å, –ø–µ—Ä–µ—Ä–≤–∞ 4-8 —Ç–∏–∂–Ω—ñ–≤.",
                "dosage_table": {
                    "hgh": {"low": "0.3-0.5 –ú–û", "medium": "0.5-1 –ú–û", "high": "1-2 –ú–û"},
                    "ipamorelin": {"low": "100-200 –º–∫–≥", "medium": "200-300 –º–∫–≥", "high": "300-400 –º–∫–≥"},
                    "ibutamoren": {"low": "10 –º–≥", "medium": "15-20 –º–≥", "high": "20-25 –º–≥"}
                },
                "timing": ["–†–∞–Ω–æ–∫ –Ω–∞—Ç—â–µ", "–ü–µ—Ä–µ–¥ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è–º (30-60 —Ö–≤)", "–í–µ—á—ñ—Ä"],
                "injection_tips": ["–ñ–∏–≤—ñ—Ç/—Å—Ç–µ–≥–Ω–æ, –≥–æ–ª–∫–∞ 29-31G", "–ë–µ—Ä–±–µ—Ä–∏–Ω 500 –º–≥ –ø–µ—Ä–µ–¥ HGH", "–ö–æ—Ä–∏—Ü—è 1-2 –≥ –∑ —ó–∂–µ—é"]
            },
            "pct": {
                "description": "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –µ–Ω–¥–æ–≥–µ–Ω–Ω–æ–≥–æ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è —Ü–∏–∫–ª—É.",
                "protocol": ["–Ü–±—É—Ç–æ–º–æ—Ä–µ–Ω 10-15 –º–≥/–¥–µ–Ω—å", "L-–∞—Ä–≥—ñ–Ω—ñ–Ω 3-5 –≥", "–ì–ª—é—Ç–∞–º—ñ–Ω 2-5 –≥", "–ì–æ–ª–æ–¥—É–≤–∞–Ω–Ω—è, HIIT"],
                "monitoring": "–¢–µ—Å—Ç–∏ IGF-1 –ø—ñ—Å–ª—è PCT."
            },
            "example_protocol": {
                "phase1": "–û—Ü—ñ–Ω–∫–∞ (–¢–∏–∂–¥–µ–Ω—å 1): –ê–Ω–∞–ª—ñ–∑–∏ (~500-1000 –≥—Ä–Ω)",
                "phase2": "–ü—Ä–∏—Ä–æ–¥–Ω–∏–π –±—É—Å—Ç: –î—ñ—î—Ç–∞ –∫–µ—Ç–æ, 5 —Ç—Ä–µ–Ω—É–≤–∞–Ω—å/—Ç–∏–∂–¥–µ–Ω—å",
                "phase3": "–¶–∏–∫–ª (8-12 —Ç–∏–∂–Ω—ñ–≤): HGH 1-2 –ú–û + –Ü–ø–∞–º–æ—Ä–µ–ª—ñ–Ω 300 –º–∫–≥",
                "phase4": "PCT (4-8 —Ç–∏–∂–Ω—ñ–≤): –Ü–±—É—Ç–æ–º–æ—Ä–µ–Ω 10-15 –º–≥",
                "cost": "–°—Ç–∞—Ä—Ç ~500-2000 USD/–º—ñ—Å—è—Ü—å (USDT/Web3 —á–µ—Ä–µ–∑ Guardian)"
            }
        }

    def create_igf1_json_files(self):
        if not os.path.exists(self.data_dir):
            os.makedirs(self.data_dir)
        with open(os.path.join(self.data_dir, "igf1_protocol.json"), "w") as f:
            json.dump(self.protocol, f, indent=2)

    def process_igf1_query(self, query: str, user, lab_results: Dict) -> Dict:
        if "igf1" in query.lower() or "hgh" in query.lower():
            return {
                "protocol": self.protocol,
                "credo": "PantelMed —Ñ–æ–∫—É—Å—É—î—Ç—å—Å—è –Ω–∞ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —Ç–∞ —è–∫–æ—Å—Ç—ñ –∂–∏—Ç—Ç—è —á–µ—Ä–µ–∑ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏.",
                "other_files": "–î–ª—è –ì–ó–¢ –¥–∏–≤. steroids.py; –î–ª—è –∞–Ω—Ç–∏–µ–π–¥–∂–∏–Ω–≥—É –¥–∏–≤. anti_aging.py."
            }
        return {"message": "–ó–∞–ø–∏—Ç –Ω–µ –ø–æ–≤‚Äô—è–∑–∞–Ω–∏–π —ñ–∑ IGF-1. –ü–µ—Ä–µ–≤—ñ—Ä anti_aging.py."}

    @staticmethod
    def test_processing():
        handler = IGF1ProtocolHandler()
        user_mock = type('User', (), {'has_access': lambda x: True})()
        lab_results = {"igf1": {"value": 150, "unit": "ng/ml"}}
        print("\nüß™ Testing IGF-1 Processing:")
        try:
            response = handler.process_igf1_query("IGF-1 –ø—Ä–æ—Ç–æ–∫–æ–ª", user_mock, lab_results)
            print(f"‚úÖ IGF-1 processed: {response['protocol']['meta']['title']}")
        except Exception as e:
            print(f"‚ùå Processing error: {e}")

if __name__ == "__main__":
    handler = IGF1ProtocolHandler()
    handler.create_igf1_json_files()
    IGF1ProtocolHandler.test_processing()
    print("\nüöÄ IGF-1 protocol module integration complete!")
